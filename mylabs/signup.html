<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MyLabs Signup</title>
  <link rel="icon" href="MyLabsLogo.png" type="image/png"/>
  <style>
    body {
      margin: 0;
      background-color: #0c0c0c;
      color: #1753aa;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      overflow-x: hidden;
    }

    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      padding: 20px;
      text-align: center;
    }

    h1 {
      font-size: 2.2rem;
      margin-bottom: 20px;
    }

    p {
      font-size: 1.2rem;
      color: #aaa;
    }

    .button {
      background-color: #1753aa;
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 20px;
      border-radius: 4px;
      transition: background-color 0.3s;
    }

    .button:hover {
      background-color: #0d3d7a;
    }

    .slide {
      display: none;
      max-width: 400px;
      width: 100%;
    }

    .visible {
      display: block;
      animation: slideIn 0.8s forwards;
    }

    @keyframes slideIn {
      0% {
        transform: translateX(100%);
        opacity: 0;
      }
      100% {
        transform: translateX(0%);
        opacity: 1;
      }
    }

    @keyframes slideOut {
      0% {
        transform: translateX(0%);
        opacity: 1;
      }
      100% {
        transform: translateX(-100%);
        opacity: 0;
      }
    }

    input {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: 1px solid #333;
      border-radius: 4px;
      background-color: #1b1b1b;
      color: #fff;
      font-size: 1rem;
    }

    .error {
      color: #d32f2f;
      font-size: 0.9rem;
      margin-top: 5px;
    }

    .confirm-field {
      margin-bottom: 15px;
      text-align: left;
    }

    .confirm-field label {
      display: block;
      margin-bottom: 5px;
      color: #ccc;
    }

    .small-note {
      font-size: 0.9rem;
      color: #777;
      margin-top: 10px;
    }

    .divider {
      margin: 30px 0;
      text-align: center;
      color: #555;
      position: relative;
    }

    .divider::before,
    .divider::after {
      content: "";
      position: absolute;
      height: 1px;
      width: 40%;
      background: #333;
      top: 50%;
    }

    .divider::before {
      left: 0;
    }
    .divider::after {
      right: 0;
    }

    .provider-btn {
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #333;
      color: #fff;
      padding: 10px 20px;
      border-radius: 4px;
      text-decoration: none;
      transition: background-color 0.3s;
    }

    .provider-btn img {
      height: 24px;
      margin-right: 10px;
    }

    .provider-btn:hover {
      background-color: #444;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Intro slides -->
    <div id="intro1" class="slide visible">
      <h1>Are you ready to level up your RekietaLabs Experience with MyLabs?</h1>
    </div>

    <div id="intro2" class="slide">
      <h1>Well then, let's get started!</h1>
    </div>

    <!-- Choice screen -->
    <div id="choiceScreen" class="slide">
      <h1>How would you like to sign up?</h1>
      <button class="button" id="emailSignupBtn">Sign Up with Email</button>

      <div class="divider">OR</div>

      <a class="provider-btn" href="https://rwwrrrutvvsbanbzzwbq.supabase.co/auth/v1/authorize?provider=github&redirect_to=https://accounts.rekietalabs.com/mylabs/login">
        <img src="/mylabs/github-mark.png" alt="GitHub Logo" />
        Sign Up with GitHub
      </a>
    </div>

    <!-- Signup flow -->
    <div id="question1" class="slide">
      <h1>What's your First Name?</h1>
      <input type="text" id="firstName" />
      <div class="error" id="errorFirst"></div>
      <button class="button" id="next1">Next</button>
    </div>

    <div id="question2" class="slide">
      <h1>What's your Last Name?</h1>
      <input type="text" id="lastName" />
      <div class="error" id="errorLast"></div>
      <button class="button" id="next2">Next</button>
    </div>

    <div id="question3" class="slide">
      <h1>What's your Email Address?</h1>
      <input type="email" id="email" />
      <div class="error" id="errorEmail"></div>
      <button class="button" id="next3">Next</button>
    </div>

    <div id="question4" class="slide">
      <h1>Create a Password</h1>
      <input type="password" id="password" />
      <div class="error" id="errorPwd"></div>
      <button class="button" id="finishBtn">Finish</button>
    </div>

    <!-- Confirmation page -->
    <div id="confirmPage" class="slide">
      <h1>Confirm Your Details</h1>

      <div class="confirm-field">
        <label for="confFirst">First Name:</label>
        <input type="text" id="confFirst" />
        <div class="error" id="errorConfFirst"></div>
      </div>

      <div class="confirm-field">
        <label for="confLast">Last Name:</label>
        <input type="text" id="confLast" />
        <div class="error" id="errorConfLast"></div>
      </div>

      <div class="confirm-field">
        <label for="confEmail">Email Address:</label>
        <input type="email" id="confEmail" />
        <div class="error" id="errorConfEmail"></div>
      </div>

      <div class="confirm-field">
        <label for="confPassword">Change Password (optional):</label>
        <input type="password" id="confPassword" placeholder="Leave blank to keep same password" />
        <div class="error" id="errorConfPwd"></div>
      </div>

      <button class="button" id="confirmBtn">Confirm & Create Account</button>
    </div>

    <!-- Email Check Screen -->
    <div id="successMessage" class="slide">
      <h1>Thank You for Signing Up!</h1>
      <p id="successText"></p>
      <p class="small-note">
        For your security, youâ€™ll need to confirm your email address before you can log in.<br>
        This page will automatically redirect to the login page in 10 seconds.
      </p>
    </div>

  </div>

  <script>
    const slides = [
      "intro1",
      "intro2",
      "choiceScreen",
      "question1",
      "question2",
      "question3",
      "question4",
      "confirmPage",
      "successMessage"
    ];

    let currentSlide = 0;

    function showSlide(id) {
      slides.forEach(s => {
        const el = document.getElementById(s);
        if (el) {
          el.style.display = "none";
        }
      });

      const el = document.getElementById(id);
      if (el) {
        el.classList.remove("visible");
        el.style.display = "block";
        void el.offsetWidth; // trigger reflow
        el.classList.add("visible");
      }
    }

    function nextSlide() {
      if (currentSlide < slides.length - 1) {
        currentSlide++;
        showSlide(slides[currentSlide]);
      }
    }

    setTimeout(() => {
      nextSlide();
    }, 5000);

    setTimeout(() => {
      nextSlide();
    }, 11000);

    document.getElementById("emailSignupBtn").addEventListener("click", () => {
      nextSlide();
    });

    document.getElementById("next1").addEventListener("click", () => {
      const val = document.getElementById("firstName").value.trim();
      if (!val) {
        document.getElementById("errorFirst").innerText = "Please enter your first name.";
        return;
      }
      document.getElementById("errorFirst").innerText = "";
      nextSlide();
    });

    document.getElementById("next2").addEventListener("click", () => {
      const val = document.getElementById("lastName").value.trim();
      if (!val) {
        document.getElementById("errorLast").innerText = "Please enter your last name.";
        return;
      }
      document.getElementById("errorLast").innerText = "";
      nextSlide();
    });

    document.getElementById("next3").addEventListener("click", () => {
      const val = document.getElementById("email").value.trim();
      if (!val) {
        document.getElementById("errorEmail").innerText = "Please enter your email.";
        return;
      }
      document.getElementById("errorEmail").innerText = "";
      nextSlide();
    });

    document.getElementById("finishBtn").addEventListener("click", () => {
      const val = document.getElementById("password").value.trim();
      if (!val) {
        document.getElementById("errorPwd").innerText = "Please enter a password.";
        return;
      }
      document.getElementById("errorPwd").innerText = "";

      // prefill confirm screen
      document.getElementById("confFirst").value = document.getElementById("firstName").value;
      document.getElementById("confLast").value = document.getElementById("lastName").value;
      document.getElementById("confEmail").value = document.getElementById("email").value;

      nextSlide();
    });

    document.getElementById("confirmBtn").addEventListener("click", async () => {
      const firstName = document.getElementById("confFirst").value.trim();
      const lastName = document.getElementById("confLast").value.trim();
      const email = document.getElementById("confEmail").value.trim();
      let password = document.getElementById("confPassword").value.trim();

      let hasError = false;

      if (!firstName) {
        document.getElementById("errorConfFirst").innerText = "First name is required.";
        hasError = true;
      } else {
        document.getElementById("errorConfFirst").innerText = "";
      }

      if (!lastName) {
        document.getElementById("errorConfLast").innerText = "Last name is required.";
        hasError = true;
      } else {
        document.getElementById("errorConfLast").innerText = "";
      }

      if (!email) {
        document.getElementById("errorConfEmail").innerText = "Email is required.";
        hasError = true;
      } else {
        document.getElementById("errorConfEmail").innerText = "";
      }

      if (hasError) return;

      if (!password) {
        password = document.getElementById("password").value;
      }

      try {
        const res = await fetch("https://api.rekietalabs.com/signup", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            first_name: firstName,
            last_name: lastName,
            email,
            password
          })
        });

        if (!res.ok) {
          const data = await res.json();
          throw new Error(data.error || "Signup failed");
        }

        document.getElementById("successText").innerText =
          `A confirmation link has been sent to ${email}. Please check your inbox and follow the instructions to activate your account.`;

        nextSlide();

        setTimeout(() => {
          window.location.href = "https://accounts.rekietalabs.com/mylabs/login";
        }, 10000);

      } catch (err) {
        alert("Signup failed: " + err.message);
      }
    });
  </script>
</body>
</html>
